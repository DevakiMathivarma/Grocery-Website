<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery</title>
    <link rel="stylesheet" href="assets/css/shop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>
    <header>
        <div class="navigation_one">
            <div>
                <p>Call us : +91996576569</p>
            </div>
            <div class="sign-up">
                <h4>Sign Up and Get 50% OFF for first order.</h4>
                <a href="#">Sign up now</a>
            </div>
            <div class="navigation_one_tracking">
                <div>
                    <i class="fa-solid fa-location-dot"></i>
                    <a href="#">Deliver to<span>411017</span></a>
                </div>
                <span>|</span>
                <div>
                    <i class="fa fa-truck"></i>
                    <a href="#">Track your order</a>
                </div>
                <span>|</span>
                <div>
                    <i class="fa-solid fa-location-dot"></i>
                    <a href="#">All Offers</a>
                </div>
            </div>
        </div>

    </header>
    <header class="navbar">
        <div class="logo">
            <img src="">
        </div>

        <div class="location">

            <label class="location-name">Location</label><br>
            <!-- <i class="fa fa-truck"></i> -->
            <select>

                <option>Tirunelveli,Tamilnadu</option>
                <option>Trichy,Tamilnadu</option>
                <option>Kanjipuram,Tamilnadu</option>
                <option>Cuddalur,Tamilnadu</option>
            </select>

        </div>
        <div class="search-container">
            <select class="category-select">
                <option>All Categories</option>
                <option>Fruits</option>
                <option>Vegetables</option>
                <option>Beverages</option>
            </select>
            <input type="text" placeholder="Search for products">
            <button><i class='bx bx-search'></i></i></button>
        </div>
        <div class="nav-icons">
            <button class="icon-btn"><i class="far fa-heart"></i></button>
            <button class="icon-btn" id="cart-icon"><i class='bx bx-shopping-bag'></i>
                <span id="cart-count">0</span>

            </button>
            <button class="icon-btn"><i class="fas fa-user"></i></button>
        </div>
    </header>
    <nav class="main-menu">
        <button class="browse-btn"><i class="fas fa-bars"></i> Browse All Categories</button>
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="fruits.html">Fruits</a>
        <a href="vegetable.html">Vegetables</a>
        <a href="#">Beverages</a>
        <a href="#">About us</a>
        <a href="#">Blogs</a>
        <span class="recently-view">Recently view <i class="fas fa-chevron-down"></i></span>
    </nav>

    <!-- end navbar section -->
    <!-- filtering category in products -->
    <section class="filtering-products">
        <div class="filtering">
            <h2>Filter Options</h2>

            <div class="category-selection" id="category-selection">
                <h3>Category</h3>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Chocolate</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Fruits</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Vegetables</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Spices</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Drinks</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Dairy</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Oils</label>
                </div>
                <div class="category-list">
                    <input type="checkbox">
                    <label>Wash</label>
                </div>
            </div>
            <!-- Price Filter -->
            <div class="price-filter">
                <h4>Price</h4>
                <label>₹ <span id="min-price">399</span> - ₹ <span id="max-price">699</span></label><br>
                <input type="range" id="price-min" min="100" max="1000" value="399" step="1"><br>
                <label>₹ <span id="min-price">699</span> - ₹ <span id="max-price">899</span></label><br>
                <input type="range" id="price-max" min="100" max="1000" value="899" step="1">
            </div>

            <!-- Star Rating Filter -->
            <div class="star-filter">
                <h4>Review</h4>
                <label><input type="checkbox" class="star-checkbox" value="5"> ⭐⭐⭐⭐⭐ 5 Star</label><br>
                <label><input type="checkbox" class="star-checkbox" value="4"> ⭐⭐⭐⭐☆ 4 Star</label><br>
                <label><input type="checkbox" class="star-checkbox" value="3"> ⭐⭐⭐☆☆ 3 Star</label><br>
                <label><input type="checkbox" class="star-checkbox" value="2"> ⭐⭐☆☆☆ 2 Star</label><br>
                <label><input type="checkbox" class="star-checkbox" value="1"> ⭐☆☆☆☆ 1 Star</label>
            </div>

            <!-- Brand Filter -->
            <div class="brand-filter">
                <h4>Brand</h4>
                <label><input type="checkbox" class="brand-checkbox" value="Fresh Harvest"> Fresh Harvest</label><br>
                <label><input type="checkbox" class="brand-checkbox" value="Nature’s products"> Nature’s
                    products</label><br>
                <label><input type="checkbox" class="brand-checkbox" value="Good Grains"> Good Grains</label><br>
                <label><input type="checkbox" class="brand-checkbox" value="Farm Fresh"> Farm Fresh</label><br>
                <label><input type="checkbox" class="brand-checkbox" value="Frozen Foods"> Frozen Foods</label>
            </div>

            <hr>

            <!-- Availability Filter -->
            <div class="availability-filter">
                <h4>Availability</h4>
                <label><input type="checkbox" class="availability-checkbox" value="In Stock" checked> In
                    Stock</label><br>
                <label><input type="checkbox" class="availability-checkbox" value="Out Of Stock"> Out Of Stock</label>
            </div>

            <div class="submit-btn">
                <button>Submit</button>
            </div>
        </div>

        <div class="color">
            <!-- <div class="featured-product-items"> -->
            <main class="product-grid" id="product-grid">
                <!-- Products injected by JavaScript -->
            </main>
            <div class="pagination-controls">
                <button id="prev-page">Previous</button>
                <span id="page-info">Page 1</span>
                <button id="next-page">Next</button>
            </div>

            <!-- </div> -->
        </div>
    </section>
    <script>
        let currentPage = 1;
        const itemsPerPage = 10;

        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const savedCart = JSON.parse(localStorage.getItem("cart")) || [];
            if (savedCart) {
                cart = savedCart;
                updateCartCount();
            }
            function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.count, 0);
            document.getElementById("cart-count").innerText = count;
        }
        // Safe parse to avoid crashing if productList is undefined
        let productList = [];
        try {
            productList = JSON.parse(localStorage.getItem("productList") || "[]");
        } catch (e) {
            console.error("Failed to parse productList from localStorage", e);
        }
        productList = productList.filter(product => product.category === "Vegetables");
        let filteredProducts = productList;

        cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const productGrid = document.getElementById("product-grid");
        document.getElementById("prev-page").addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                renderProducts(filteredProducts);
            }
        });

        document.getElementById("next-page").addEventListener("click", () => {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderProducts(filteredProducts);
            }
        });

        // Update renderProducts to use only paginatedItems
        function renderProducts(products) {
            filteredProducts = products;
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedItems = products.slice(start, end);
            productGrid.innerHTML = "";

            paginatedItems.forEach(product => {
                const card = document.createElement("div");
                card.className = "featured-product-items";
                card.innerHTML = `
                    <div class="featured-product-items-list">
                        <div class="featured-product-items-list-dicount">
                            <div><h3>${product.discount}</h3></div>
                            <div><button><i class="far fa-heart"></i></button></div>
                        </div>
                        <div class="featured-product-items-list-image">
                            <img src="${product.image}">
                        </div>
                        <div class="featured-product-text">
                            <div><p>${product.category}</p></div>
                            <div><span>${product.rating}</span><i class='bx bxs-star'></i></div>
                        </div>
                        <div class="featured-product-name">
                            <h5>${product.name}</h5>
                            <p>${product.weight}</p>
                        </div>
                        <div class="featured-product-price">
                            <div>
                                <span>&#8377 ${product.originalPrice}</span>
                                <small>₹ ${product.price}</small>
                            </div>
                            <div><button class="add-to-cart" data-id="${product.id}"><i class='bx bx-shopping-bag'></i>ADD</button></div>
                        </div>
                    </div>`;
                // Ensure the button exists after the card is created
                const addToCartButton = card.querySelector('.add-to-cart');

                // Add the event listener inside the loop so the correct `product` is passed
                addToCartButton.addEventListener("click", () => {
                    // Use console.log to ensure the correct product object is passed
                    console.log("Product being added:", product);

                    // Store the selected product in localStorage
                    localStorage.setItem("selectedProduct", JSON.stringify(product));

                    // Redirect to the description page
                    window.location.href = "description.html";
                });
                productGrid.appendChild(card);
            });

            // // Update page info
            // document.getElementById("page-info").textContent = `Page ${currentPage} of ${Math.ceil(products.length / itemsPerPage)}`;

            // // Disable buttons at bounds
            // document.getElementById("prev-page").disabled = currentPage === 1;
            // document.getElementById("next-page").disabled = currentPage >= Math.ceil(products.length / itemsPerPage);
            // ✅ Correctly update page info
            const totalPages = Math.ceil(products.length / itemsPerPage);
            document.getElementById("page-info").textContent = `Page ${currentPage} of ${totalPages}`;

            // ✅ Handle button disable state
            document.getElementById("prev-page").disabled = currentPage === 1;
            document.getElementById("next-page").disabled = currentPage >= totalPages;

        }



        renderProducts(productList);

        document.querySelector('.submit-btn button').addEventListener('click', () => {
            const selectedBrands = Array.from(document.querySelectorAll('.brand-checkbox:checked')).map(cb => cb.value);
            const selectedCategories = Array.from(document.querySelectorAll('#category-selection input:checked')).map(cb => cb.nextElementSibling.textContent.trim());
            const selectedRatings = Array.from(document.querySelectorAll('.star-checkbox:checked')).map(cb => parseFloat(cb.value));
            const selectedAvailability = Array.from(document.querySelectorAll('.availability-checkbox:checked')).map(cb => cb.value);

            const minPrice = parseFloat(document.getElementById("price-min").value);
            const maxPrice = parseFloat(document.getElementById("price-max").value);



            const brandMap = {
                "Fresh Harvest": "Vegetables",
                "Farm Fresh": "Vegetables",
                "Nature’s products": "Fruits",
                "Frozen Foods": "Dairy",
                "Good Grains": "Spices"
            };

            const filtered = productList.filter(product => {
                const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(product.category);


                const brandMatch = selectedBrands.length === 0 || selectedBrands.some(brand => {
                    return brandMap[brand] === product.category;
                });
                const availabilityMatch = selectedAvailability.length === 0 || selectedAvailability.includes(product.availability || "In Stock");
                const ratingMatch = selectedRatings.length === 0 || selectedRatings.some(r => product.rating <= r);
                const priceMatch = product.price >= minPrice && product.price <= maxPrice;

                console.log({ product, categoryMatch, brandMatch, availabilityMatch, ratingMatch, priceMatch });

                return categoryMatch && brandMatch && availabilityMatch && ratingMatch && priceMatch;
            });

            console.log(filtered)
            currentPage = 1; // Add this before renderProducts(filtered);
            renderProducts(filtered);
        });

        document.getElementById("cart-icon").addEventListener("click", function () {
            window.location.href = "shoppingcart.html";    
        });
    </script>
</body>

</html>